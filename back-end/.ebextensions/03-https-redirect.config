# HTTPS Configuration for Application Load Balancer
# Note: Replace CERT_ARN with your actual ACM certificate ARN

option_settings:
  # HTTP Listener (port 80) - redirects to HTTPS
  aws:elbv2:listener:80:
    ListenerEnabled: true
    Protocol: HTTP
    Rules: redirect-to-https

  # HTTPS Listener (port 443)
  aws:elbv2:listener:443:
    ListenerEnabled: true
    Protocol: HTTPS
    SSLPolicy: ELBSecurityPolicy-TLS-1-2-2017-01
    # SSLCertificateArns: REPLACE_WITH_YOUR_ACM_CERTIFICATE_ARN

  # Default process for health checks
  aws:elbv2:listener:default:
    DefaultProcess: default

  # Health check configuration
  aws:elasticbeanstalk:environment:process:default:
    HealthCheckPath: /actuator/health
    HealthCheckInterval: 15
    HealthCheckTimeout: 5
    HealthyThresholdCount: 2
    UnhealthyThresholdCount: 5
    Port: 5000
    Protocol: HTTP
    DeregistrationDelay: 20
    StickinessEnabled: true
    StickinessLBCookieDuration: 86400

# Redirect rule from HTTP to HTTPS
Resources:
  AWSEBV2LoadBalancerListener:
    Type: AWS::ElasticLoadBalancingV2::Listener
    Properties:
      DefaultActions:
        - Type: redirect
          RedirectConfig:
            Protocol: HTTPS
            Port: 443
            StatusCode: HTTP_301
      LoadBalancerArn:
        Ref: AWSEBV2LoadBalancer
      Port: 80
      Protocol: HTTP
